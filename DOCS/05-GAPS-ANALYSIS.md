# Анализ пробелов — Danang Expat Hub

> **Last Verified:** 2026-02-17

---

## Матрица зрелости разделов

| Раздел | Чтение | Создание | Редактирование | Удаление | Фильтры | Карта | Перевод | Чат |
|--------|--------|----------|----------------|----------|---------|-------|---------|-----|
| Коммьюнити | ✅ | ✅ | ❌ | ❌ | ✅теги | ✅ | ✅ | ❌ |
| Аренда | ✅ | ❌ | ❌ | ❌ | ⚠район | ❌ | ❌ | ❌ |
| Маркет | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| Места | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| События | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| AI Чат | ✅ | — | — | — | — | — | ❌ | ⚠AI |
| Профиль | ✅ | — | ❌ | — | — | — | ❌ | — |

---

## КРИТИЧЕСКИЕ ПРОБЕЛЫ (P0)

### 1. Нет P2P чата между пользователями
**Текущее:** Контакт через внешние ссылки (Telegram, WhatsApp, email)
**Нужно:** Real-time чат внутри приложения с:
- Автоматический перевод сообщений на язык получателя
- Переключатель "показать оригинал" (флаг страны)
- Голосовые сообщения → STT → перевод → текст на целевом языке
- Контекст (к какому объявлению/месту/событию привязан чат)

**Влияние:** Без чата невозможна коммуникация между экспатами и вьетнамцами внутри платформы. Основная ценность приложения теряется.

### 2. Нет UGC для ключевых разделов
**Текущее:** Только community posts создаются юзерами. Все остальные разделы — read-only с seed-данными.
**Нужно:**
- Пользователи могут создавать listings (аренда)
- Пользователи могут создавать market items (купля-продажа)
- Бизнесы могут добавлять places
- Организаторы могут создавать events

**Влияние:** Без UGC приложение — статический каталог. Нет роста контента, нет причины возвращаться.

### 3. Нет модерации контента
**Текущее:** Нет ни AI, ни ручной модерации. Любой может создать пост с любым содержанием.
**Нужно:**
- AI модерация при создании (проверка на спам, нецензурную лексику, мошенничество)
- Кнопка "Пожаловаться" на контенте
- Очередь модерации для админов
- Авто-бан при множественных жалобах

### 4. Нет админ-панели
**Текущее:** Управление только через Supabase Dashboard / SQL
**Нужно:**
- Веб-панель для модераторов
- Управление контентом (approve/reject/ban)
- Управление пользователями
- Аналитика

### 5. Безопасность API — все endpoints открыты
**Текущее:**
- 0 из 14 endpoints проверяют авторизацию
- Все используют serviceRole (обходят RLS)
- Можно читать чужие данные, тратить LLM кредиты
**Нужно:**
- Auth middleware для всех endpoints
- Rate limiting (особенно для AI и translate)
- Input validation
- RLS на всех таблицах

---

## СЕРЬЁЗНЫЕ ПРОБЕЛЫ (P1)

### 6. LanguageSelector не подключён
Компонент создан (`fsd/features/language-selector/`) с красивым dropdown и флагами, но НЕ используется нигде. Пользователь не может сменить язык интерфейса.

### 7. i18n не работает на большинстве страниц
Ключи переводов существуют в JSON файлах, но используются только в CommunityPage. Все остальные страницы — захардкоженный английский.

### 8. Нет RSVP для событий
Бейдж "RSVP" — чисто визуальный. Нет таблицы event_attendees, нет API, нет кнопки.

### 9. Events — самая бедная страница
Нет: поиска, фильтров, Detail Sheet, создания, RSVP, разделения upcoming/past.

### 10. Places без координат
Таблица `places` не имеет lat/lng. Только текстовый address. Невозможно показать на карте.

### 11. Нет загрузки изображений
Нет API для загрузки фото. Все images — URL строки (в основном Unsplash из seed).

### 12. Нет streaming ответов AI
Чат ждёт полный ответ от LLM (может быть 5-10 секунд). Нет SSE/streaming.

---

## КОСМЕТИЧЕСКИЕ ПРОБЕЛЫ (P2)

### 13. BottomNav перегружен
9 элементов навигации. Нужно 5 + "More" или группировка.

### 14. Нет pull-to-refresh
Стандартный паттерн мобильных приложений отсутствует.

### 15. FilterSheet, PriceRangeSlider не подключены
UI-компоненты созданы, но нигде не используются.

### 16. Нет пагинации
Все списки загружаются одним запросом с limit. Нет cursor/offset пагинации.

### 17. Нет full-text search
Поиск через ILIKE — медленный и неточный. Нет tsvector, нет fuzzy matching.

### 18. Нет updated_at триггеров
Ни одна таблица не имеет автоматического обновления updated_at.

---

## НЕСООТВЕТСТВИЯ В КОДЕ

| # | Описание | Где |
|---|----------|-----|
| 1 | Favorites: executor использует `item_type`/`user_id`, API route — `source`/`tg_user_id` | ai/executor.ts vs api/favorites/route.ts |
| 2 | Events executor использует поле `date`, таблица имеет `starts_at` | ai/executor.ts vs migration |
| 3 | Translate route: приоритет OpenAI, Assistant route: приоритет OpenRouter | Разные route.ts |
| 4 | images в places добавляется дважды (миграция 2 и 3) | migrations |
| 5 | ai_conversations.user_id → auth.users, но остальная схема на tg_users | migration 4 vs 1-3 |

---

## Итого: критический путь к "идеальному приложению"

```
P0 (блокеры):
├── P2P чат с real-time переводом
├── UGC для listings, market, places, events
├── Auth middleware + RLS
├── Модерация (AI + ручная)
└── Админ-панель

P1 (must have):
├── LanguageSelector в UI
├── i18n на всех страницах
├── Streaming AI ответы
├── RSVP для событий
├── Координаты для places
└── Загрузка изображений

P2 (nice to have):
├── BottomNav оптимизация
├── Pull-to-refresh
├── Full-text search
├── Пагинация
└── Push-уведомления
```
